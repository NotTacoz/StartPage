<!DOCTYPE html>

<html lang="en">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>New Tab</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <script>
    function getWeatherData() {
      $(document).ready(async function () {
        var city = undefined;
        await fetch("https://ipinfo.io/json")
          .then(function (response) {
            return response.json();
          })
          .then(function (myJson) {
            city = myJson.city;
            console.log;
          })
          .catch(function (error) {
            console.log("Error: " + error);
          });
        $.getJSON("https://api.weatherapi.com/v1/current.json?key=76aa7ac854eb413c82565451211807&q=" + city, function (data) {})
          .done(function (data) {
            $("#weather").text(data.current.condition.text + " " + data.current.temp_c + "Â°C");
          })
          .fail(function (data) {});
      });
    }

    function updateTime() {
      $(document).ready(function () {
        var currentTime = new Date();
        var hours = currentTime.getHours();
        var minutes = currentTime.getMinutes();
        var day = currentTime.getDay();
        var date = currentTime.getDate();
        var month = currentTime.getMonth();
        // convert day to text
        var days = [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday",
        ];
        var dayText = days[day];
        // add contraction to date
        var dateText = date + "";
        if (date === 1) {
          dateText = date + "st";
        } else if (date === 2) {
          dateText = date + "nd";
        } else if (date === 3) {
          dateText = date + "rd";
        } else if (date < 21) {
          dateText = date + "th";
        }

        // convert month to text
        var months = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];
        var monthText = months[month];
        // convert date to text

        // console.log(d_str);

        if (minutes < 10) {
          minutes = "0" + minutes;
        }

        if (hours > 11) {
          var AMPM = "PM";
          hours -= 12;
        } else {
          var AMPM = "AM";
        }
        var d_str = dayText + ", " + dateText + " " + monthText;
        var t_str = hours + ":" + minutes + " " + AMPM;
        $("#time").text(t_str);
        $("#date").text(d_str);
      });
    }
    updateTime(); // immeditatelly runs the function, so that there is no lag
    getWeatherData();
    setInterval(updateTime, 1000);
    setInterval(getWeatherData, 900000);
  </script>

  <style>
    @import url(styles.css);
  </style>

  <body>
    <div class="center">
      <p class="medium" id="weather">Unknown</p>
      <p class="large" id="time"></p>
      <p class="medium" id="date"></p>
    </div>
  </body>
</html>
